---
title: "Relaci√≥n del sedentarismo con problemas auditivos y visuales"
author: "Antonia A√±azco, Daniel Marr√≥n, Jorge Bermejo"
date: "`r Sys.Date()`"
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
    logo: "IMAGES/logo-universidad-de-burgos.png"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## √çNDICE

- Introducci√≥n
- Objetivos
- M√©todos
- Resultados
- Discusi√≥n


## INTRODUCCI√ìN üìñ

El sedentarismo representa un **serio problema** para la salud p√∫blica, especialmente en Occidente, seg√∫n Rodulfo, J. I. A. (2019) ü§ì [1]. 

Algunos efectos seg√∫n Hu, F. B. (2003) ü§ì [2]: 

‚Ä¢ Hipertensi√≥n 

‚Ä¢ Diabetes tipo II 

‚Ä¢ Obesidad 

Ahora bien, ¬øalguna vez os hab√©is planteado **c√≥mo afecta al sedentarismo a otros aspectos acerca de nuestra salud no tan obvios**? 

## OBJETIVOS

‚Ä¢ Relaci√≥n entre el sedentarismo y el uso de aud√≠fonos por grupos de edad

‚Ä¢ Relaci√≥n entre el sedentarismo y el uso de aud√≠fonos seg√∫n el sexo

‚Ä¢ Relaci√≥n entre el sedentarismo y el uso de gafas por grupos de edad

‚Ä¢ Relaci√≥n entre el sedentarismo y el uso de gafas seg√∫n el sexo


## M√âTODOS (I)
### Importamos las librer√≠as y los datos a usar
```{r, warning = FALSE}
library(tidyjson)
library(rjson)
library(tidyverse)
```
## M√âTODOS (II)
### Importamos las librer√≠as y los datos a usar
```{r, warning = FALSE}
library(readr)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(ggborderline)
library(ggdark)


audifono_sexo_edad <- fromJSON(file = "DATOS/audif_SexAge_miles.json")
gafas_sexo_edad <- fromJSON(file = "DATOS/gafas_SexAge_miles.json")
imc_sexo_edad <- fromJSON(file = "DATOS/imc_SexAge_miles.json")
sedentarismo_sexo_edad <- fromJSON(file = "DATOS/seden_SexAge_miles.json")
```
## M√âTODOS (III)
### FORMATEO DE DATOS
```{r}
audif_sexo_edad <- audifono_sexo_edad %>% spread_all()
gafas_sexo_edad <- gafas_sexo_edad %>% spread_all()
imc_sexo_edad <- imc_sexo_edad %>% spread_all()
sedent_sexo_edad <- sedentarismo_sexo_edad %>% spread_all()
```
#### Formateamos el conjunto de datos: "imc_SexAge"
```{r}
imc_sexo_edad %>% gather_object %>% json_types %>% count(name,type) 
```
## M√âTODOS (IV)
#### Formateamos el conjunto de datos: "imc_SexAge"
```{r}
imc_SexAge <- imc_sexo_edad %>%
enter_object(Data) %>%
gather_array %>%
spread_all()
imc_SexAge$Sexo <- NA
imc_SexAge$Edad <- NA
imc_SexAge$IMC <- NA
for (i in 1:dim(imc_SexAge)[1]){
  r <- unlist(gregexpr(',', imc_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  imc_SexAge$Sexo[i] <- substring(imc_SexAge$Nombre[i], 0, primera_coma-1)
  edad <- substring(imc_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  if (edad != " TOTAL"){
  edad <- substring(imc_SexAge$Nombre[i], primera_coma+4, primera_coma+12)
  }
  imc_SexAge$Edad[i] <- edad
  imc_SexAge$IMC[i] <- substring(imc_SexAge$Nombre[i], segunda_coma+1)
}
```
## M√âTODOS (V)
#### Formateamos el conjunto de datos: "imc_SexAge"
Algunas aclaraciones al respecto:
```{r}
imc_SexAge %>% gather_object %>% json_types %>% count(name,type) 
```
Este "Code Chunk" nos sirve para saber a qu√© datos hemos de acceder. En particular, se formatear√° los datos de la categor√≠a array (excepto MetaData) En el resultado anterior ya dicho array no se encuentra porque ya lo hemos formateado.
Adem√°s, las funciones unlist(gregexpr()) devuelve el √≠ndice de todas las apariciones de un determinado character en un character de mayor longitud. 
La funci√≥n substring() devuelve el sub-character presente en un character de mayor longitud entre ciertos √≠ndices pasados como argumento.

## M√âTODOS (VI)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "sedent_sexo_edad"
```{r}
sedent_sexo_edad %>% gather_object %>% json_types %>% count(name, type)
```
## M√âTODOS (VII)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "sedent_sexo_edad"
```{r}
sedent_SexAge <- sedent_sexo_edad %>% 
enter_object(Data) %>% 
gather_array %>% 
spread_all()
sedent_SexAge$Sexo <- NA
sedent_SexAge$Edad <- NA
sedent_SexAge$Sedentarismo <- NA
for (i in 1:dim(sedent_SexAge)[1]){
  r <- unlist(gregexpr(',', sedent_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  sedent_SexAge$Sexo[i] <- substring(sedent_SexAge$Nombre[i], 0, primera_coma-1)
  edad <- substring(sedent_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  if (edad != " TOTAL"){
  edad <- substring(sedent_SexAge$Nombre[i], primera_coma+4, primera_coma+12)
  }
  sedent_SexAge$Edad[i] <- edad
  sedent_SexAge$Sedentarismo[i] <- substring(sedent_SexAge$Nombre[i], segunda_coma+1)
}
```
## M√âTODOS (VIII)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "gafas_sexo_edad"

```{r}
gafas_sexo_edad %>% gather_object %>% json_types %>% count(name,type) 
```
## M√âTODOS (IX)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "gafas_sexo_edad"
```{r}
gafas_SexAge <- gafas_sexo_edad %>%
  enter_object(Data) %>%
  gather_array %>%
  spread_all()
gafas_SexAge$Sexo <- NA
gafas_SexAge$Edad <- NA
gafas_SexAge$Gafas <- NA
for (i in 1:dim(gafas_SexAge)[1]){
  r <- unlist(gregexpr(',', gafas_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  gafas_SexAge$Sexo[i] <- substring(gafas_SexAge$Nombre[i], 0, primera_coma-1)
  edad <- substring(gafas_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  if (edad != " TOTAL"){
  edad <- substring(gafas_SexAge$Nombre[i], primera_coma+4, primera_coma+12)
  }
  gafas_SexAge$Edad[i] <- edad
  gafas_SexAge$Gafas[i] <- substring(gafas_SexAge$Nombre[i], segunda_coma+1)
}
```
## M√âTODOS (X)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "audif_sexo_edad"
```{r}
audif_sexo_edad %>% gather_object %>% json_types %>% count(name, type)
```
## M√âTODOS (XI)
### FORMATEO DE DATOS
#### Formateamos el conjunto de datos: "audif_sexo_edad"
```{r}
audif_SexAge <- audif_sexo_edad %>% 
  enter_object(Data) %>% 
  gather_array %>% 
  spread_all()
audif_SexAge$Sexo <- NA
audif_SexAge$Edad <- NA
audif_SexAge$Audifono <- NA
for (i in 1:dim(audif_SexAge)[1]){
  r <- unlist(gregexpr(',', audif_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  audif_SexAge$Sexo[i] <- substring(audif_SexAge$Nombre[i], 0, primera_coma-1)
  edad <- substring(audif_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  if (edad != " TOTAL"){
  edad <- substring(audif_SexAge$Nombre[i], primera_coma+4, primera_coma+12)
  }
  audif_SexAge$Edad[i] <- edad
  audif_SexAge$Audifono[i] <- substring(audif_SexAge$Nombre[i], segunda_coma+1)
}
```
## M√âTODOS (XII)
#### *Uni√≥n de los conjuntos de datos sedentarismo y uso de aud√≠fonos por edad y sexo*
```{r, warning=FALSE}
sedent_audif <-  
  audif_SexAge %>% 
  mutate(numero_audifonos = Valor*1000) %>% 
  select("Sexo", "Audifono", "numero_audifonos", "Edad") %>% 
  full_join(x = ., 
            y = sedent_SexAge %>% 
            mutate(personas_sedentarias = Valor*1000) %>% 
            select("Sexo", "Sedentarismo", "personas_sedentarias", "Edad"),
            by = c("Sexo" = "Sexo", "Edad" = "Edad"))
```
## M√âTODOS (XIII)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de aud√≠fonos*
```{r}
grafico1 <-sedent_audif %>% filter(Sexo != "Ambos sexos") %>% 
  filter(Audifono %in% c(" S√≠", " No")) %>%
  filter(Sedentarismo %in% c(" S√≠", " No")) %>% 
  mutate(ratio_audifonos_por_persona = 100*numero_audifonos/personas_sedentarias) %>% 
  filter(Edad != " TOTAL") 
```

## M√âTODOS (XIV)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de aud√≠fonos*

```{r}
cont <- 1
sedentarios <- c(NA, NA, NA, NA, NA, NA, NA, NA)
no_sedentarios <- c(NA, NA, NA, NA, NA, NA, NA, NA)
aux <- 1
  for (i in 1:(length(grafico1$personas_sedentarias)/4)){
  si_sedent <- grafico1$personas_sedentarias[cont]
  cont <- cont + 1
  no_sedent <- grafico1$personas_sedentarias[cont]
  cont <- cont + 3
  sedentarios[aux] <- si_sedent
  no_sedentarios[aux] <- no_sedent
  aux <- aux + 1
}

grafico1$porcentaje_sedentarios <- NA
grafico1$porcentaje_no_sedentarios <- NA
aux <- 1
  for (i in 1:length(grafico1$porcentaje_sedentarios)){
  grafico1$porcentaje_sedentarios[i] <- sedentarios[aux]*100/(sedentarios[aux] + no_sedentarios[aux])
  grafico1$porcentaje_no_sedentarios[i] <- no_sedentarios[aux]*100/(sedentarios[aux] + no_sedentarios[aux])
  if(i%%4 == 0){
  aux <- aux + 1
  }
}
```

## M√âTODOS (XV)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de aud√≠fonos*
```{r}
cont <- 1
audifonos <- c(NA, NA, NA, NA, NA, NA, NA, NA)
no_audifonos <- c(NA, NA, NA, NA, NA, NA, NA, NA)
aux <- 1
 for (i in 1:(length(grafico1$numero_audifonos)/4)){
 audif <- grafico1$numero_audifonos[cont]
 cont <- cont + 2
 no_audif <- grafico1$numero_audifonos[cont]
 cont <- cont + 2
 audifonos[aux] <- audif
 no_audifonos[aux] <- no_audif
 aux <- aux + 1
}

grafico1$porcentaje_audifonos <- NA
grafico1$porcentaje_no_audifonos <- NA
aux <- 1
 for (i in 1:length(grafico1$numero_audifonos)){
 grafico1$porcentaje_audifonos[i] <- audifonos[aux]*100/(audifonos[aux] + no_audifonos[aux])
 grafico1$porcentaje_no_audifonos[i] <- no_audifonos[aux]*100/(audifonos[aux] + no_audifonos[aux])
 if(i%%4 == 0){
 aux <- aux + 1
 }
}
```
## M√âTODOS (XVI)
#### *Uni√≥n de los conjuntos de datos sedentarismo y uso de aud√≠fonos por edad y sexo*
```{r, warning = FALSE} 
sedent_gafas <-  
  gafas_SexAge %>% 
  mutate(numero_gafas = Valor*1000) %>% 
  select("Sexo", "Gafas", "numero_gafas", "Edad") %>% 
  full_join(x = ., 
            y = sedent_SexAge %>% 
            mutate(personas_sedentarias = Valor*1000) %>% 
            select("Sexo", "Sedentarismo", "personas_sedentarias", "Edad"),
            by = c("Sexo" = "Sexo", "Edad" = "Edad"))

```
## M√âTODOS (XVII)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de gafas*
```{r}
grafico2 <-sedent_gafas %>%
  filter(Sexo != "Ambos sexos") %>%
  filter(Gafas %in% c(" S√≠", " No")) %>%
  filter(Sedentarismo %in% c(" S√≠", " No")) %>% 
  mutate(ratio_gafas_por_persona = 100*numero_gafas/personas_sedentarias) %>% 
  filter(Edad!=" TOTAL")
```
## M√âTODOS (XVIII)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de gafas*

```{r}
cont <- 1
sedentarios <- c(NA, NA, NA, NA, NA, NA, NA, NA)
no_sedentarios <- c(NA, NA, NA, NA, NA, NA, NA, NA)
aux <- 1
for (i in 1:(length(grafico2$personas_sedentarias)/4)){
si_sedent <- grafico2$personas_sedentarias[cont]
cont <- cont + 1
no_sedent <- grafico2$personas_sedentarias[cont]
cont <- cont + 3
sedentarios[aux] <- si_sedent
no_sedentarios[aux] <- no_sedent
aux <- aux + 1
}
```

```{r}
grafico2$porcentaje_sedentarios <- NA
grafico2$porcentaje_no_sedentarios <- NA
aux <- 1
for (i in 1:length(grafico2$porcentaje_sedentarios)){
grafico2$porcentaje_sedentarios[i] <- sedentarios[aux]*100/(sedentarios[aux] + no_sedentarios[aux])
grafico2$porcentaje_no_sedentarios[i] <- no_sedentarios[aux]*100/(sedentarios[aux] + no_sedentarios[aux])
if(i%%4 == 0){
aux <- aux + 1
  }
}
```
## M√âTODOS (XIX)
#### *Modificaci√≥n del conjunto de datos en relaci√≥n al sedentarismo y al uso de gafas*
```{r}
cont <- 1
gafas <- c(NA, NA, NA, NA, NA, NA, NA, NA)
no_gafas <- c(NA, NA, NA, NA, NA, NA, NA, NA)
aux <- 1
for (i in 1:(length(grafico2$numero_gafas)/4)){
gf <- grafico2$numero_gafas[cont]
cont <- cont + 2
no_gf <- grafico2$numero_gafas[cont]
cont <- cont + 2
gafas[aux] <- gf
no_gafas[aux] <- no_gf
aux <- aux + 1
}

grafico2$porcentaje_gafas <- NA
grafico2$porcentaje_no_gafas <- NA
aux <- 1
for (i in 1:length(grafico2$numero_gafas)){
grafico2$porcentaje_gafas[i] <- gafas[aux]*100/(gafas[aux] + no_gafas[aux])
grafico2$porcentaje_no_gafas[i] <- no_gafas[aux]*100/(gafas[aux] + no_gafas[aux])
if(i%%4 == 0){
aux <- aux + 1
}
}
```
## RESULTADOS (I)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (I)*
##### GR√ÅFICO I
```{r, eval=FALSE}
grafico1_H <- grafico1 %>% filter(.data = ., Sexo == "Hombres")
grafico1_M <- grafico1 %>% filter(.data = ., Sexo == "Mujeres")

grafico1 %>%
  ggplot() + 
  geom_col(aes(x = Edad, y = porcentaje_sedentarios/4, fill = "Sedentarismo"), color = "black") + 
    scale_fill_manual(values = c("#FFEC8B")) +
  geom_borderline(data = grafico1_H, aes(x = Edad, y = porcentaje_audifonos, 
    color = "Uso de aud√≠fonos (Hombres)"), linewidth = 1.2, bordercolor = "black", group = 1) +
  geom_borderline(data = grafico1_M, aes(x = Edad, y = porcentaje_audifonos, 
    color = "Uso de aud√≠fonos (Mujeres)"), linewidth = 1.2, bordercolor = "black",group = 1) + 
  scale_y_continuous(sec.axis = sec_axis(~., name = "Porcentaje Uso aud√≠fonos (%)")) +
  guides(x = guide_axis(angle =45)) +
  facet_wrap(facets = vars(Sexo), nrow = 1) +
  geom_point(data = grafico1_M, aes(x = Edad, y = porcentaje_audifonos), size=3, shape=21, fill="snow",
      color = "black") +
  geom_point(data = grafico1_H, aes(x = Edad, y = porcentaje_audifonos), size=3, shape=21, fill="snow",
      color = "black") +
```
## RESULTADOS (II)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (II)*
##### GR√ÅFICO I
```{r, eval=FALSE}
  guides(fill = guide_legend(title = "Sedentarismo")) +
  guides(color = guide_legend(title = "Uso de Aud√≠fonos")) +
  labs(x= "Grupos de edad", 
       y = "Porcentaje sedentarismo (%)",
       title = "Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo") +
  dark_theme_gray() + 
    theme (panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    plot.title =element_text(
        family = "serif",
        size = 12,
        hjust = 0.5,
        vjust = 2),
    axis.title = element_text(             
                   family = "serif",           
                   size = 9),              
    axis.text = element_text(             
                   family = "serif",            
                   size = 7),                
    axis.text.x = element_text(           
                    margin=margin(8, b = 12)),
    axis.text.y = element_text(           
                    margin=margin(8, b = 12))) + scale_color_manual(values = c("#9400D3", "cyan")) +
```    

## RESULTADOS (III)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (III)*
##### GR√ÅFICO I
```{r, eval=FALSE}
theme(legend.title = element_text(
                    family = "serif",
                    size = 9),
        legend.text = element_text (
                    family = "serif",
                    size = 7),
        legend.position = "bottom")

```

## RESULTADOS (IV)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (IV)*
##### GR√ÅFICO I
```{r, echo=FALSE, message=FALSE, warning=FALSE}

grafico1_H <- grafico1 %>% filter(.data = ., Sexo == "Hombres")
grafico1_M <- grafico1 %>% filter(.data = ., Sexo == "Mujeres")

grafico1 %>%
  ggplot() + 
  geom_col(aes(x = Edad, y = porcentaje_sedentarios/4, fill = "Sedentarismo"), color = "black") + 
    scale_fill_manual(values = c("#FFEC8B")) +
  geom_borderline(data = grafico1_H, aes(x = Edad, y = porcentaje_audifonos, 
    color = "Uso de aud√≠fonos (Hombres)"), linewidth = 1.2, bordercolor = "black", group = 1) +
  geom_borderline(data = grafico1_M, aes(x = Edad, y = porcentaje_audifonos, 
    color = "Uso de aud√≠fonos (Mujeres)"), linewidth = 1.2, bordercolor = "black",group = 1) + 
  scale_y_continuous(sec.axis = sec_axis(~., name = "Porcentaje Uso aud√≠fonos (%)")) +
  guides(x = guide_axis(angle =45)) +
  facet_wrap(facets = vars(Sexo), nrow = 1) +
  geom_point(data = grafico1_M, aes(x = Edad, y = porcentaje_audifonos), size=3, shape=21, 
    fill="snow", color = "black") +
  geom_point(data = grafico1_H, aes(x = Edad, y = porcentaje_audifonos), size=3, shape=21, 
    fill="snow", color = "black") +
  guides(fill = guide_legend(title = "Sedentarismo")) +
  guides(color = guide_legend(title = "Uso de Aud√≠fonos")) +
  labs(x= "Grupos de edad", 
       y = "Porcentaje sedentarismo (%)",
       title = "Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo") +
  dark_theme_gray() + 
    theme (panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    plot.title =element_text(
        family = "serif",
        size = 12,
        hjust = 0.5,
        vjust = 2),
    axis.title = element_text(             
                   family = "serif",           
                   size = 9),              
    axis.text = element_text(             
                   family = "serif",            
                   size = 7),                
    axis.text.x = element_text(           
                    margin=margin(8, b = 12)),
    axis.text.y = element_text(           
                    margin=margin(8, b = 12))) + scale_color_manual(values = c("#9400D3", "cyan")) +
    theme(legend.title = element_text(
                    family = "serif",
                    size = 9),
        legend.text = element_text (
                    family = "serif",
                    size = 7),
        legend.position = "bottom")
```

## RESULTADOS (V)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (V)*
##### GR√ÅFICO II
```{r, eval=FALSE}
grafico1 %>%
  ggplot() + 
  geom_col(aes(x = Sexo, y = porcentaje_sedentarios/4, fill = "Sedentarismo"), color = "black") + 
  scale_fill_manual(values = c("#FFEC8B")) +
  scale_y_continuous(sec.axis = sec_axis(~., name = "Porcentaje Uso aud√≠fonos (%)")) +
  guides(x = guide_axis(angle =45)) +
  guides(fill = guide_legend(title = "Sedentarismo")) +
  guides(shape = guide_legend(title = "Uso de Aud√≠fonos")) +
  facet_wrap(facets = vars(Edad), nrow = 2) +
  geom_point(data = grafico1, aes(x = Sexo, y = porcentaje_audifonos, shape = "Uso de Audifonos"), 
      size=3, fill="snow", color = "black") +
  scale_shape_manual(values = c(21, 21)) +
```
## RESULTADOS (VI)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (VI)*
##### GR√ÅFICO II
```{r, eval=FALSE}
  labs(x= "Divisi√≥n por sexos", 
       y = "Porcentaje sedentarismo (%)",
       title = "Relaci√≥n del sedentarismo con el uso de aud√≠fonos seg√∫n sexo y edad") +
  dark_theme_gray() + 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    plot.title =element_text(
        family = "serif",
        size = 12,
        hjust = 0.5,
        vjust = 2),
    axis.title = element_text(             
                   family = "serif",           
                   size = 9),              
    axis.text = element_text(             
                   family = "serif",            
                   size = 7),                
    axis.text.x = element_text(           
                    margin=margin(8, b = 12)),
    axis.text.y = element_text(           
                    margin=margin(8, b = 12))) +
```
## RESULTADOS (VII)
#### *Relaci√≥n del sedentarismo con el uso de aud√≠fonos por grupos de edad y sexo (VII)*
##### GR√ÅFICO II
```{r, eval=FALSE}
theme(legend.title = element_text(
                      family = "serif",
                      size = 9),
        legend.text = element_text (
                      family = "serif",
                      size = 7),
        legend.position = "bottom")
```