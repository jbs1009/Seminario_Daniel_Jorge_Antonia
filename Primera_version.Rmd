---
title: "Relaci√≥n del sedentarismo con problemas auditivos y visuales"
author: "Jorge Bermejo, Antonia A√±azco, Daniel Marr√≥n"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
<div style="text-align: justify">
## INTRODUCCI√ìN üìñ

El sedentarismo representa un serio problema para la salud p√∫blica, especialmente en Occidente, seg√∫n Rodulfo, J. I. A. (2019) ü§ì [1]. Algunos de sus principales efectos, ampliamente estudiados, se evidencian en trastornos como la hipertensi√≥n, la diabetes tipo II o la obesidad, las cuales ya alcanzan la categor√≠a de epidemia en los Estados Unidos seg√∫n Hu, F. B. (2003) ü§ì [2]. En el mismo art√≠culo se habla tambi√©n de la relaci√≥n directa entre estos trastornos y un estilo de vida sedentario, y, en particular, se comenta como un estilo de vida sedentario tiene consecuencias muy negativas independientemente de dieta y cantidad de horas dedicadas a la actividad f√≠sica.

Ahora bien, ¬øalguna vez os hab√©is planteado c√≥mo afecta al sedentarismo a otros aspectos acerca de nuestra salud no tan obvios?

En el siguiente trabajo vamos a tratar de encontrar, o en su defecto descartar, la existencia de una correlaci√≥n directa entre un estilo de vida sedentario y el desarrollo de problemas de visi√≥n y/o auditivos vali√©ndonos para ello de sendos estudios expuestos m√°s adelante acerca de la distribuci√≥n de dichos problemas y el estilo de vida a lo largo del territorio espa√±ol teniendo adem√°s en cuenta otros factores como edad o sexo. 


Carga de los datos a usar:

```{r}
library(tidyjson)
library(rjson)
library(tidyverse)
library(readr)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)

audifono_sexo_edad <- fromJSON(file = "DATOS/audif_SexAge_miles.json")
#evolucion_afiliados_once <- fromJSON(file = "DATOS/evolucion_afiliados_once.json")
gafas_sexo_edad <- fromJSON(file = "DATOS/gafas_SexAge_miles.json")
###gafas_sexo_pais_nacimiento <- fromJSON(file = "DATOS/gafas_sexo_pais_nacimiento.json")
###grupo_discapacidad_sexo_edad <- fromJSON(file = "DATOS/grupo_discapacidad_sexo_edad.json")
imc_sexo_edad <- fromJSON(file = "DATOS/imc_SexAge_miles.json")
#patologias_visuales_afiliados_once <- fromJSON(file = "DATOS/PATOLOGIAS_VISUALES_AFILIADOS_ONCE.json")
###sedentarismo_clase_social <- fromJSON(file = "DATOS/sedentarismo_clasesocial.json")
#sedentarismo_sexo_ccaa <- read_excel("DATOS/sedentarismo_sexo_ccaa.xlsx") 
sedentarismo_sexo_edad <- fromJSON(file = "DATOS/seden_SexAge_miles.json")
###uso_braille_sexo_y_edad <- fromJSON(file = "DATOS/uso_braille_sexo_y_edad.json")
```

Formateamos los datos:

```{r}
###imc_sexo_caa <- imc_sexo_ccaa %>% spread_all()
###audif_sexo_ccaa <- audifono_sexo_ccaa %>% spread_all()
audif_sexo_edad <- audifono_sexo_edad %>% spread_all()
###evol_afil_once <- evolucion_afiliados_once %>% spread_all()
gafas_sexo_edad <- gafas_sexo_edad %>% spread_all()
###gafas_sexo_paisnac <- gafas_sexo_pais_nacimiento %>% spread_all()
#discap_sexo_edad <- grupo_discapacidad_sexo_edad %>% spread_all()
imc_sexo_edad <- imc_sexo_edad %>% spread_all()
#pato_visu_afil_once <- patologias_visuales_afiliados_once %>% spread_all()
###sedent_clasocial <- sedentarismo_clase_social %>% spread_all()
sedent_sexo_edad <- sedentarismo_sexo_edad %>% spread_all()
###braille_sexo_edad <- uso_braille_sexo_y_edad %>% spread_all()
```
```{r, eval = FALSE}
imc_sexo_edad %>% gather_object %>% json_types %>% count(name,type) 
```
```{r}
imc_SexAge <- imc_sexo_edad %>%
enter_object(Data) %>%
gather_array %>%
spread_all()
imc_SexAge$Sexo <- NA
imc_SexAge$Edad <- NA
imc_SexAge$IMC <- NA
for (i in 1:dim(imc_SexAge)[1]){
  r <- unlist(gregexpr(',', imc_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  imc_SexAge$Sexo[i] <- substring(imc_SexAge$Nombre[i], 0, primera_coma-1)
  imc_SexAge$Edad[i] <- substring(imc_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  imc_SexAge$IMC[i] <- substring(imc_SexAge$Nombre[i], segunda_coma+1)
}
```
Algunas aclaraciones al respecto:
```{r, eval = FALSE}
imc_sexo_gredad %>% gather_object %>% json_types %>% count(name,type) 
```
Este "Code Chunk" (que no se eval√∫a) nos sirve para saber a que datos hemos de acceder.
Adem√°s, las funciones `unlist(gregexpr())` devuelve el √≠ndice de todas las apariciones de un determinado character en un character de mayor longitud. 
La funci√≥n `substring()` devuelve el sub-character presente en un character de mayor longitud entre ciertos √≠ndices pasados como argumento.

```{r, eval = FALSE}
audif_sexo_edad %>% gather_object %>% json_types %>% count(name, type)
```
```{r}
sedent_SexAge <- sedent_sexo_edad %>% 
enter_object(Data) %>% 
gather_array %>% 
spread_all()
sedent_SexAge$Sexo <- NA
sedent_SexAge$Edad <- NA
sedent_SexAge$Sedentarismo <- NA
for (i in 1:dim(sedent_SexAge)[1]){
  r <- unlist(gregexpr(',', sedent_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  sedent_SexAge$Sexo[i] <- substring(sedent_SexAge$Nombre[i], 0, primera_coma-1)
  sedent_SexAge$Edad[i] <- substring(sedent_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  sedent_SexAge$Sedentarismo[i] <- substring(sedent_SexAge$Nombre[i], segunda_coma+1)
}
```
```{r, eval = FALSE}
gafas_sexo_edad %>% gather_object %>% json_types %>% count(name,type) 
```
```{r}
gafas_SexAge <- gafas_sexo_edad %>%
  enter_object(Data) %>%
  gather_array %>%
  spread_all()
gafas_SexAge$Sexo <- NA
gafas_SexAge$Edad <- NA
#gafas_SexAge$Estudios <- NA
gafas_SexAge$Gafas <- NA
for (i in 1:dim(gafas_SexAge)[1]){
  r <- unlist(gregexpr(',', gafas_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
#  tercera_coma <- r[3]
  gafas_SexAge$Sexo[i] <- substring(gafas_SexAge$Nombre[i], 0, primera_coma-1)
  gafas_SexAge$Edad[i] <- substring(gafas_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
#  gafas_SexAge$Estudios[i] <- substring(gafas_SexAge$Nombre[i], segunda_coma+1, tercera_coma-1)
  gafas_SexAge$Gafas[i] <- substring(gafas_SexAge$Nombre[i], segunda_coma+1)
}
```
```{r, eval = FALSE}
audif_sexo_edad %>% gather_object %>% json_types %>% count(name, type)
```
```{r}
audif_SexAge <- audif_sexo_edad %>% 
  enter_object(Data) %>% 
  gather_array %>% 
  spread_all()
audif_SexAge$Sexo <- NA
audif_SexAge$Edad <- NA
audif_SexAge$Audifono <- NA
for (i in 1:dim(audif_SexAge)[1]){
  r <- unlist(gregexpr(',', audif_SexAge$Nombre[i]))
  primera_coma <- r[1]
  segunda_coma <- r[2]
  audif_SexAge$Sexo[i] <- substring(audif_SexAge$Nombre[i], 0, primera_coma-1)
  audif_SexAge$Edad[i] <- substring(audif_SexAge$Nombre[i], primera_coma+1, segunda_coma-1)
  audif_SexAge$Audifono[i] <- substring(audif_SexAge$Nombre[i], segunda_coma+1)
}
```

```{r}
sedent_audif <-  
  audif_SexAge %>% 
  mutate(numero_audifonos = Valor*1000) %>% 
  select("Sexo", "Audifono", "numero_audifonos", "Edad") %>% 
  full_join(x = ., 
            y = sedent_SexAge %>% 
            mutate(personas_sedentarias = Valor*1000) %>% 
            select("Sexo", "Sedentarismo", "personas_sedentarias", "Edad"),
            by = c("Sexo" = "Sexo", "Edad" = "Edad"))

```
B√°sicamente, en estos dos bloques de c√≥digo lo que hacemos es, primeramente, unir los conjuntos de datos acerca de uso de aud√≠fonos y de sedentarismo. Para ello, primeramente, mutamos ambos conjuntos de datos y seleccionamos aquellos atributos de nuestro inter√©s. Para, como se ha indicado, llevar a cabo dicha mutaci√≥n, multiplicamos por mil, porque, tras revisar los conjuntos de datos (en particular hemos necesitado abrir los datos para ver las unidades en las que se encuentran, mal ah√≠, datos.gov üò°) vimos que se encontraban en miles de personas. 
Posteriormente, unimos por sexo y edad (dado que los niveles de ambas variables son los mismos) (hay que aclarar que la edad, a priori, habr√≠a de ser una variable continua, pero es categ√≥rica al haber sido discretizada).
A la hora de representar los datos, primero modificamos debidamente el conjunto de resultados hasta obtener uno que se amolda a los objetivos que pretendemos estudiar. Finalmente, antes de crear la gr√°fica de barras, creamos una variable que relacione la cantidad de aud√≠fonos con el n√∫mero de personas. Esto se debe a que son severamente desiguales las cantidades de personas que son y no sedentarias y que usan y no aud√≠fonos.
```{r}
sedent_audif %>% filter(Sexo == "Ambos sexos") %>% 
  filter(Audifono %in% c(" S√≠", " No")) %>%
  filter(Sedentarismo %in% c(" S√≠", " No")) %>% 
  mutate(ratio_audifonos_por_persona = numero_audifonos/personas_sedentarias) %>% 
  ggplot(data = .,aes(x = Sedentarismo , y = ratio_audifonos_por_persona)) +
  xlab("Sedentarismo") +
  ylab("PERSONAS QUE USAN AUD√çFONO") +
  geom_col()

```


## DATOS üìñ


## BIBLIOGRAF√çA üìñ

[1] Rodulfo, J. I. A. (2019). Sedentarism, a disease from XXI century. Cl√≠nica e Investigaci√≥n en arteriosclerosis (English edition), 31(5), 233-240. https://doi.org/10.1016/j.artere.2019.04.001 

 
[2]  Hu, F. B. (2003). Sedentary lifestyle and risk of obesity and type 2 diabetes. Lipids, 38(2), 103-108. 
<div/>


